services:
  influxdb:
    image: influxdb:2.8.0
    container_name: influxdb
    init: true
    restart: unless-stopped
    logging:
      driver: journald
      options:
        tag: "{{.Name}}"
    # No direct port exposure - access via Traefik at influxdb.{hostname}.local
    # halos-proxy-network is auto-injected by container-packaging-tools
    volumes:
      - ${CONTAINER_DATA_ROOT}/config:/etc/influxdb2
      - ${CONTAINER_DATA_ROOT}/db:/var/lib/influxdb2
    environment:
      - DOCKER_INFLUXDB_INIT_MODE=setup
      - DOCKER_INFLUXDB_INIT_USERNAME=${INFLUXDB_ADMIN_USER:-admin}
      - DOCKER_INFLUXDB_INIT_PASSWORD=${INFLUXDB_ADMIN_PASSWORD:-halos}
      - DOCKER_INFLUXDB_INIT_ORG=${INFLUXDB_ORG:-marine}
      - DOCKER_INFLUXDB_INIT_BUCKET=${INFLUXDB_BUCKET:-marine}
      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=${INFLUXDB_ADMIN_TOKEN:-halos-default-token-change-in-production}
      - DOCKER_INFLUXD_QUERY_CONCURRENCY=1
      - DOCKER_INFLUXD_QUERY_MEMORY_BYTES=20971520
