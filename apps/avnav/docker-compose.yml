services:
  avnav:
    image: xfreex/avnav-stable:20251028
    container_name: avnav
    restart: unless-stopped
    logging:
      driver: journald
      options:
        tag: "{{.Name}}"
    # HTTP UI via Traefik at avnav.{hostname}.local
    # halos-proxy-network is auto-injected by container-packaging-tools
    ports:
      # Keep non-HTTP ports for external tool compatibility
      - "${AVNAV_WEBSOCKET_PORT:-8083}:8083"  # WebSocket for chart plotters
      - "${AVNAV_NMEA_PORT:-34567}:34567"      # NMEA TCP stream
    volumes:
      - ${CONTAINER_DATA_ROOT}/data:/var/lib/avnav
      - /dev:/dev
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket
    environment:
      - UID=1000
      - GID=1000
    extra_hosts:
      - "host.docker.internal:host-gateway"
    user: "1000:1000"
    privileged: true
