name: Release Published

on:
  release:
    types: [published]

jobs:
  trigger-packaging:
    runs-on: ubuntu-latest
    steps:
    - name: Extract version from tag
      id: version
      run: |
        # Extract version from tag (remove 'v' prefix if present)
        VERSION="${{ github.event.release.tag_name }}"
        VERSION="${VERSION#v}"
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "Extracted version: $VERSION"

    - name: Trigger APT repository
      uses: peter-evans/repository-dispatch@v3
      with:
        token: ${{ secrets.REPO_DISPATCH_PAT }}
        repository: hatlabs/apt.hatlabs.fi
        event-type: package-updated
        client-payload: |
          {
            "repository": "${{ github.repository }}",
            "distro": "any",
            "channel": "stable",
            "component": "main",
            "version": "${{ steps.version.outputs.version }}",
            "release_url": "${{ github.event.release.html_url }}"
          }
